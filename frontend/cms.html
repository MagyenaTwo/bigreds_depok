{% extends "base.html" %}

{% block title %}Galeri Nobar - CMS Bigreds Depok{% endblock %}

{% block content %}
<h1>Galeri Nobar</h1>

<!-- Upload Form -->
<form action="/cms/upload" method="post" enctype="multipart/form-data" class="upload-form" style="background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
  <h2 style="margin-bottom: 15px;">Upload Media Baru</h2>
  
  <label for="title">Judul</label><br>
  <input type="text" id="title" name="title" required style="width: 100%; margin-bottom: 10px;"><br>
<label for="tanggal">Tanggal & Waktu</label><br>
<input type="datetime-local" id="tanggal" name="tanggal" required style="margin-bottom: 10px;"><br>

 
<label for="kategori">Kategori</label><br>
<select id="kategori" name="kategori" required style="width: 100%; margin-bottom: 10px; padding: 5px;">
  <option value="">-- Pilih Kategori --</option>
  <option value="matchday">Matchday</option>
  <option value="community">Community</option>
  <option value="event">Event</option>
</select><br>
<label for="deskripsi">Deskripsi</label><br>
<textarea id="deskripsi" name="deskripsi" rows="4" style="width: 100%; margin-bottom: 10px; padding: 8px; border: 1px solid #ccc; border-radius: 6px;"></textarea><br>


  <label for="image">Pilih Gambar/Video</label><br>
  <input type="file" id="image" name="image" multiple accept="image/*,video/*" required style="margin-bottom: 10px;"><br>

  <button type="submit">Upload</button>
</form>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">

  <!-- Input pencarian dengan tombol clear -->
  <div style="position: relative; flex: 1; max-width: 280px;">
    <input
      type="text"
      id="searchInput"
      placeholder="Cari berdasarkan judul..."
      onkeyup="filterTable()"
      style="
        width: 100%;
        padding: 10px 36px 10px 14px;
        font-size: 14px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        background-color: #f9fafb;
        color: #111827;
        box-shadow: inset 0 1px 2px rgba(0,0,0,0.04);
        transition: border-color 0.2s ease;
      "
      onfocus="this.style.borderColor='#3b82f6'"
      onblur="this.style.borderColor='#d1d5db'"
    >

    <span
      id="clearSearch"
      onclick="clearSearch()"
      style="
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
        color: #6b7280;
        cursor: pointer;
        display: none;
        user-select: none;
      "
    >√ó</span>
  </div>



  <!-- Total Media -->
  <div style="font-weight: bold; font-size: 15px; display: flex; flex-direction: column; align-items: flex-end;">
    <div><span style="font-size: 18px;">üñºÔ∏è</span> Total Media: {{ images|length }}</div>
  </div>
</div>


<!-- Media List Table -->
<div class="table-container">
  <table class="styled-table" id="mediaTable">
  <thead>
  <tr>
    <th>No</th>
    <th>Judul</th>
    <th>Kategori</th>
    <th>Tanggal</th>
    <th>Gambar</th>
    <th>Aksi</th>
  </tr>
</thead>
<tbody>
  {% for media in images %}
  <tr>
  <td class="nomor-kolom" data-label="No">{{ loop.index }}</td>
  <td data-label="Judul">{{ media.title }}</td>
  <td data-label="Kategori">{{ media.kategori or '-' }}</td>
  <td data-label="Tanggal">
    {% if media.tanggal %}
      {{ media.tanggal|datetimeformat('%d-%m-%Y') }}
    {% else %}
      -
    {% endif %}
  </td>
  <td data-label="Lihat">
    <a href="{{ media.image_url }}" target="_blank" class="bukti-btn">Lihat</a>
  </td>
 <td data-label="Aksi">
     <form action="/delete_event/{{ media.id }}" method="post" style="display:inline;">
 <!-- Tombol Delete -->
<b<button type="button" 
        onclick="showDeleteConfirm('{{ media.id }}')" 
        style="background:transparent;border:none;color:#e53935;font-size:18px;cursor:pointer;">
  üóëÔ∏è
</button>

      </form>
    </td>
  </tr>

  {% endfor %}
</tbody>
</table>
<!-- Modal Konfirmasi -->
<div id="deleteModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:8px; width:300px; text-align:center;">
    <p>Yakin ingin menghapus media ini?</p>
    <div style="margin-top:15px;">
      <button id="confirmDeleteBtn" style="background:#e53935;color:white;padding:8px 16px;border:none;border-radius:4px;cursor:pointer;">
        Hapus
      </button>
      <button onclick="closeDeleteModal()" style="background:#ccc;padding:8px 16px;border:none;border-radius:4px;cursor:pointer;">
        Batal
      </button>
    </div>
  </div>
</div>
  <div class="pagination" style="margin-top: 25px;">
  {% if current_page > 1 %}
    <a href="?page={{ current_page - 1 }}">&laquo; Prev</a>
  {% endif %}

  {% for i in range(1, total_pages + 1) %}
    <a href="?page={{ i }}" class="{% if i == current_page %}active{% endif %}">{{ i }}</a>
  {% endfor %}

  {% if current_page < total_pages %}
    <a href="?page={{ current_page + 1 }}">Next &raquo;</a>
  {% endif %}
</div>


</div>

<script>
function filterTable() {
    const input = document.getElementById("searchInput");
    const filter = input.value.toLowerCase();
    const clearBtn = document.getElementById("clearSearch");
    const tableRows = document.querySelectorAll("table tbody tr"); // sesuaikan jika berbeda

    // Tampilkan tombol clear jika ada input
    clearBtn.style.display = filter ? "block" : "none";

    tableRows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? "" : "none";
    });
  }

  function clearSearch() {
    const input = document.getElementById("searchInput");
    input.value = "";
    filterTable();
  }

let selectedDeleteId = null;

function showDeleteConfirm(id) {
  selectedDeleteId = id;
  document.getElementById('deleteModal').style.display = 'flex';
}

function closeDeleteModal() {
  selectedDeleteId = null;
  document.getElementById('deleteModal').style.display = 'none';
}

document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
  if (selectedDeleteId) {
    // Buat form POST secara dinamis
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/cms/delete/${selectedDeleteId}`;
    document.body.appendChild(form);
    form.submit();
  }
});
</script>
{% endblock %}
