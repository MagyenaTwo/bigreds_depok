{% extends "base.html" %}

{% block title %}Data Tiket - CMS Bigreds Depok{% endblock %}

{% block content %}
<h1>DASHBOARD</h1>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
  <input type="text" id="searchInput" placeholder="Cari berdasarkan nama..." class="search-input" onkeyup="filterTable()" style="flex: 1; max-width: 250px;">
  <div style="font-weight: bold; font-size: 15px; display: flex; flex-direction: column; align-items: flex-end;">
    <div><span style="font-size: 18px;">üéüÔ∏è</span> Total Tiket: {{ total_pemesan }}</div>

    
  </div>
</div>


<div class="table-container">
  <table class="styled-table" id="tiketTable">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>ID Card</th>
        <th>Jumlah</th>
        <th>WhatsApp</th>
        <th>Status</th>
        <th>Waktu Daftar</th>
        <th>Bukti Transfer</th>
      </tr>
    </thead>
    <tbody>
      {% for tiket in daftar_tiket %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ tiket.nama }}</td>
        <td>{{ tiket.id_card or '-' }}</td>
        <td>{{ tiket.jumlah }}</td>
        <td>
          <a href="https://wa.me/{{ tiket.whatsapp }}" target="_blank" class="wa-link">
            {{ tiket.whatsapp }}
          </a>
        </td>
        <td>
          <span class="status-label {{ tiket.status|lower }}">{{ tiket.status }}</span>
        </td>
        <td>{{ tiket.created_at.strftime('%d-%m-%Y %H:%M') }}</td>
        <td>
          <a href="{{ tiket.bukti_transfer_url }}" target="_blank" class="bukti-btn">Lihat Bukti</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<div class="pagination">
  {% if current_page > 1 %}
    <a href="?page={{ current_page - 1 }}">&laquo; Prev</a>
  {% endif %}

  {% for i in range(1, total_pages + 1) %}
    <a href="?page={{ i }}" class="{% if i == current_page %}active{% endif %}">{{ i }}</a>
  {% endfor %}

  {% if current_page < total_pages %}
    <a href="?page={{ current_page + 1 }}">Next &raquo;</a>
  {% endif %}
</div>

<script>
  function filterTable() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const rows = document.querySelectorAll("#tiketTable tbody tr");
    rows.forEach(row => {
      const nama = row.cells[1].textContent.toLowerCase();
      row.style.display = nama.includes(input) ? "" : "none";
    });
  }
</script>
{% endblock %}

