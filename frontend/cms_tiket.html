{% extends "base.html" %}

{% block title %}Data Tiket - CMS Bigreds Depok{% endblock %}

{% block content %}
<h1>DASHBOARD</h1>
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
  <input type="text" id="searchInput" placeholder="Cari berdasarkan nama..." class="search-input" onkeyup="filterTable()" style="flex: 1; max-width: 250px;">

  <div style="display: flex; flex-direction: row; align-items: center; gap: 20px; font-weight: bold; font-size: 15px;">
    <div><span style="font-size: 18px;">💰</span> Total Pemasukan: {{ total_pemasukan | rupiah }}</div>
    <div><span style="font-size: 18px;">🎟️</span> Total Tiket: {{ total_pemesan }}</div>
  </div>
</div>



<div class="table-container">
  <table class="styled-table" id="tiketTable">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>ID Card</th>
        <th>Jumlah</th>
        <th>Metode</th>
        <th>WhatsApp</th>
        <th>Nominal</th>
        <th>Waktu Pembelian</th>
        <th>Bukti Transfer</th>
      </tr>
    </thead>
    <tbody>
      {% for tiket in daftar_tiket %}
      {% set pesan_whatsapp = (
  " BigReds Depok,\n\n"
  ~ "Hallo *" ~ tiket.nama ~ "* Terima kasih telah melakukan pembelian tiket NOBAR.\n\n"
  ~ "*Detail Tiket:*\n"
  ~ "• Status: " ~ tiket.status|capitalize ~ "\n"
  ~ "• Jumlah Tiket: " ~ tiket.jumlah|string ~ "\n"
  ~ "• Total Pembayaran: Rp" ~ tiket.total_harga|string ~ "\n"
  ~ "• Tiket: " ~ tiket.tiket_url ~ "\n\n"
  ~ "Ayu Tingting makan pisang gepok, siapa kamu gak penting, kita Kopites dari Depok! 🙏"
) %}


      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ tiket.nama }}</td>
        <td>{{ tiket.id_card or '-' }}</td>
        <td>{{ tiket.jumlah }}</td>
        <td>{{ tiket.metode_pembayaran }}</td>
        <td>
      <a href="https://wa.me/62{{ tiket.whatsapp[1:] }}?text={{ pesan_whatsapp | urlencode }}" target="_blank" class="tombol-wa">
  Kirim Tiket 
</a>



        </td>
    <td>{{ tiket.total_harga | rupiah }}</td>


        <td>{{ tiket.created_at.strftime('%d-%m-%Y %H:%M') }}</td>
        <td>
          <a href="{{ tiket.bukti_transfer_url }}" target="_blank" class="bukti-btn">Lihat Bukti</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<div class="pagination">
  {% if current_page > 1 %}
    <a href="?page={{ current_page - 1 }}">&laquo; Prev</a>
  {% endif %}

  {% for i in range(1, total_pages + 1) %}
    <a href="?page={{ i }}" class="{% if i == current_page %}active{% endif %}">{{ i }}</a>
  {% endfor %}

  {% if current_page < total_pages %}
    <a href="?page={{ current_page + 1 }}">Next &raquo;</a>
  {% endif %}
</div>

<script>
  function filterTable() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const rows = document.querySelectorAll("#tiketTable tbody tr");
    rows.forEach(row => {
      const nama = row.cells[1].textContent.toLowerCase();
      row.style.display = nama.includes(input) ? "" : "none";
    });
  }
</script>
{% endblock %}

